<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AgroSync</title>
    <!-- CSS Base y Variables -->
    <link rel="stylesheet" href="css/base.css">
    <!-- CSS Componentes/Secciones -->
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/diagnosis.css">
    <link rel="stylesheet" href="css/compost.css">
    <link rel="stylesheet" href="css/assistant.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/auth.css"> 
    <link rel="stylesheet" href="css/dark_mode.css">
    <link rel="stylesheet" href="css/responsive_utilities.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Contenedor para el Header Dinámico -->
        <header class="app-header" id="main-app-header">
            <!-- El contenido del header se cargará aquí por JavaScript -->
        </header>

        <!-- Page: Home -->
        <div id="home" class="page"> 
            <main class="main-content">
                <!-- Contenido de Home -->
                <section class="weather-card card">
                    <div class="weather-header">
                        <h3>Clima Actual</h3>
                        <div class="weather-icon" id="weather-icon-element"><i class="fas fa-spinner fa-spin"></i></div>
                    </div>
                    <div class="weather-grid">
                        <div class="weather-item">
                            <span class="weather-emoji"><i class="fas fa-thermometer-half"></i></span>
                            <div class="weather-value" id="weather-temp">--°</div>
                            <div class="weather-label">Temperatura</div>
                        </div>
                        <div class="weather-item">
                            <span class="weather-emoji"><i class="fas fa-tint"></i></span>
                            <div class="weather-value" id="weather-humidity">--%</div>
                            <div class="weather-label">Humedad</div>
                        </div>
                        <div class="weather-item">
                            <span class="weather-emoji"><i class="fas fa-wind"></i></span>
                            <div class="weather-value" id="weather-wind">--</div>
                            <div class="weather-label">km/h</div>
                        </div>
                    </div>
                    <div id="weather-location" style="text-align: center; margin-top: 15px; font-size: 0.875rem; opacity: 0.8;">Obteniendo ubicación...</div>
                </section>

                <section class="quick-actions">
                    <button class="action-btn" onclick="showPage('diagnosis')">
                        <span class="action-emoji"><i class="fas fa-camera"></i></span>
                        <span class="action-text">Escanear Planta</span>
                    </button>
                    <button class="action-btn secondary" onclick="showPage('assistant')">
                        <span class="action-emoji"><i class="fas fa-robot"></i></span>
                        <span class="action-text">Asistente IA</span>
                    </button>
                </section>

                <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-seedling"></i></span>
                        <h3 class="section-title">Mis Plantas</h3>
                    </div>
                    <div id="plants-list-container" class="plants-list">
                        <p id="plants-login-prompt" style="text-align: center; color: var(--gray-500);">
                            <a href="#" onclick="showPage('profile'); return false;">Inicia sesión</a> o <a href="#" onclick="showPage('profile'); return false;">regístrate</a> para añadir y ver tus plantas.
                        </p>
                    </div>
                </section>

                <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-bell"></i></span>
                        <h3 class="section-title">Alertas Recientes</h3>
                    </div>
                    <div class="notifications-list">
                         <div class="notification notification-high">
                            <div class="notification-content">
                                <div class="notification-text"><i class="fas fa-exclamation-triangle"></i> Posible plaga detectada en tomates</div>
                                <div class="notification-time">hace 5 min</div>
                            </div>
                        </div>
                        <div class="notification notification-success">
                             <div class="notification-content">
                                <div class="notification-text"><i class="fas fa-check-circle"></i> Compostaje óptimo - pH perfecto</div>
                                <div class="notification-time">hace 1h</div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Page: Diagnosis -->
        <div id="diagnosis" class="page">
            <main class="main-content">
                <div class="page-header">
                    <h2><i class="fas fa-stethoscope"></i> Diagnóstico de Plantas</h2>
                    <p>Usa la cámara para identificar enfermedades o deficiencias.</p>
                </div>
                <section class="camera-section card">
                    <div class="camera-interface">
                        <div class="camera-preview">
                            <span class="camera-emoji"><i class="fas fa-camera-retro"></i></span>
                            <p>Apunta a la hoja afectada y toma una foto clara.</p>
                        </div>
                        <button class="camera-btn" onclick="simulateCamera(event)"><i class="fas fa-camera"></i> Tomar Foto</button>
                    </div>
                </section>
                 <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-microscope"></i></span>
                        <h3 class="section-title">Resultados del Análisis</h3>
                    </div>
                    <div class="analysis-results">
                         <div class="analysis-card analysis-warning">
                            <div class="analysis-header">
                                <span class="analysis-emoji"><i class="fas fa-exclamation-triangle"></i></span>
                                <h4 class="analysis-title">Riesgo Detectado</h4>
                            </div>
                            <p>Probabilidad de pulgón en los próximos 7 días: 75%</p>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Page: Compost Calculator -->
        <div id="compost" class="page">
            <main class="main-content">
                 <div class="page-header">
                    <h2><i class="fas fa-calculator"></i> Calculadora de Compostaje</h2>
                    <p>Planifica tu compostaje para obtener el mejor abono.</p>
                </div>
                 <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-balance-scale"></i></span>
                        <h3 class="section-title">Ingresa tus Datos</h3>
                    </div>
                    <div class="compost-calculator-input">
                        <label for="compost-amount">Cantidad de compost deseada (kg):</label>
                        <input type="number" id="compost-amount" value="1" min="0.5" step="0.5">
                        <button id="calculate-compost-btn" class="action-btn" style="margin-top: 1rem; width: 100%;"><i class="fas fa-cogs"></i> Calcular</button>
                    </div>
                </section>
                <section id="compost-results-section" class="card" style="display: none;">
                     <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-chart-pie"></i></span>
                        <h3 class="section-title">Resultados Estimados</h3>
                    </div>
                    <div class="compost-results">
                        <h4><i class="fas fa-seedling" style="color:var(--primary-green)"></i> Materiales Verdes (Ricos en Nitrógeno):</h4>
                        <p id="green-materials-amount">Aproximadamente X kg - Y litros</p>
                        <p><strong>Ejemplos:</strong> Restos de frutas y verduras, posos de café, recortes de césped fresco, estiércol de herbívoros (conejo, gallina).</p>
                        <h4 style="margin-top:1.5rem;"><i class="fas fa-leaf" style="color: #8B4513;"></i> Materiales Marrones (Ricos en Carbono):</h4>
                        <p id="brown-materials-amount">Aproximadamente X kg - Y litros</p>
                        <p><strong>Ejemplos:</strong> Hojas secas, ramas pequeñas trituradas, cartón sin tinta (trozos pequeños), paja, serrín (de madera no tratada).</p>
                        <h4 style="margin-top:1.5rem;"><i class="fas fa-clock"></i> Tiempo Estimado de Fermentación:</h4>
                        <p id="fermentation-time">Entre X y Y semanas (varía según método y cuidado).</p>
                        <h4 style="margin-top:1.5rem;"><i class="fas fa-hand-holding-heart"></i> Cuidados Esenciales:</h4>
                        <ul id="compost-care-tips">
                            <li>Mantener una buena relación Carbono/Nitrógeno (aprox. 25-30 partes de Carbono por 1 de Nitrógeno en peso, o 2-3 partes de Marrones por 1 de Verdes en volumen).</li>
                            <li>Asegurar una humedad adecuada (como una esponja escurrida).</li>
                            <li>Airear la pila regularmente (cada 1-2 semanas) para oxigenar.</li>
                            <li>Trozar los materiales grandes para acelerar la descomposición.</li>
                            <li>Evitar carnes, lácteos, grasas, plantas enfermas o con semillas de malezas invasoras.</li>
                        </ul>
                        <h4 style="margin-top:1.5rem;"><i class="fas fa-trophy"></i> Logros de Compostaje:</h4>
                        <ul id="compost-achievements">
                           <li><i class="fas fa-award" style="color:var(--warning)"></i> ¡Primer compost iniciado!</li>
                           <li><i class="fas fa-award" style="color:var(--warning)"></i> ¡Primera volteada exitosa!</li>
                           <li><i class="fas fa-award" style="color:var(--success)"></i> ¡Compost maduro listo para usar!</li>
                        </ul>
                    </div>
                </section>
            </main>
        </div>
        
        <!-- Page: Assistant -->
        <div id="assistant" class="page">
            <main class="main-content">
                 <div class="page-header">
                    <h2><i class="fas fa-comments"></i> Chatea con AgriBot</h2>
                    <p>Resuelve tus dudas sobre jardinería y agricultura.</p>
                </div>
                <section class="card" style="padding: 0; overflow:visible;">
                    <div class="chat-interface"> 
                        <div class="chat-messages">
                            <!-- Los mensajes se cargarán dinámicamente según el estado del usuario -->
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="userInput" placeholder="Escribe tu pregunta aquí...">
                            <button id="sendMessageBtn"><i class="fas fa-paper-plane"></i> Enviar</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Page: Profile -->
        <div id="profile" class="page">
            <main class="main-content">
                <div id="profile-logged-in-content" style="display: none;">
                    <section class="profile-info">
                        <div class="profile-avatar" id="profile-avatar-initials">--</div>
                        <h3 id="profile-username">Nombre de Usuario</h3>
                        <p class="profile-level" id="profile-email">correo@ejemplo.com</p>
                        <button id="logout-btn" class="action-btn danger" style="margin-top: 1.5rem; background: var(--danger);"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
                    </section>
                    <section class="card">
                        <div class="section-header">
                            <span class="section-emoji"><i class="fas fa-plus-circle"></i></span>
                            <h3 class="section-title">Añadir Nueva Planta</h3>
                        </div>
                        <form id="add-plant-form" class="add-plant-form">
                            <div class="form-group">
                                <label for="plant-name">Nombre de la Planta:</label>
                                <input type="text" id="plant-name" name="plant_name" required>
                            </div>
                            <div class="form-group">
                                <label for="plant-description">Descripción (opcional):</label>
                                <textarea id="plant-description" name="plant_description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="plant-health">Estado de Salud Inicial:</label>
                                <select id="plant-health" name="plant_health" required>
                                    <option value="Saludable" selected>Saludable</option>
                                    <option value="Advertencia">Advertencia</option>
                                    <option value="Peligro">Peligro</option>
                                </select>
                            </div>
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 1rem;">
                                <i class="fas fa-save"></i> Guardar Planta
                            </button>
                        </form>
                        <div id="add-plant-message" class="form-message" style="margin-top: 1rem;"></div>
                    </section>
                </div>
                <div id="profile-guest-content" style="display: none;">
                    <div class="page-header">
                        <h2><i class="fas fa-user-circle"></i> Mi Perfil</h2>
                        <p>Inicia sesión o regístrate para acceder a todas las funciones.</p>
                    </div>
                    <section class="quick-actions">
                        <button class="action-btn primary" onclick="window.location.href='login.html'">
                            <span class="action-emoji"><i class="fas fa-sign-in-alt"></i></span>
                            <span class="action-text">Iniciar Sesión</span>
                        </button>
                        <button class="action-btn success" onclick="window.location.href='register.html'">
                             <span class="action-emoji"><i class="fas fa-user-plus"></i></span>
                            <span class="action-text">Crear Cuenta</span>
                        </button>
                    </section>
                </div>
                <section class="stats-grid" id="profile-stats-grid" style="display:none;"> 
                    <!-- ... contenido de stats ... -->
                </section>
                <section class="card" id="profile-achievements-card" style="display:none;"> 
                    <!-- ... contenido de logros ... -->
                </section>
                <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-cog"></i></span>
                        <h3 class="section-title">Configuración General</h3>
                    </div>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Ubicación</h4>
                                <p>Permitir acceso a ubicación para clima local</p>
                            </div>
                            <div class="toggle-switch" id="locationToggleContainer" onclick="toggleLocation()">
                                <input type="checkbox" id="locationToggle" class="sr-only" checked>
                                <div class="toggle-circle"></div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Modo Oscuro</h4>
                                <p>Cambiar entre tema claro y oscuro</p>
                            </div>
                            <div class="toggle-switch" id="darkModeToggleContainer" onclick="toggleDarkMode()">
                                <input type="checkbox" id="darkModeToggle" class="sr-only">
                                <div class="toggle-circle"></div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div> 

    <!-- Contenedor para la Navegación Inferior -->
    <nav class="bottom-nav" id="main-bottom-nav">
        <!-- El contenido de la navegación se cargará aquí por JavaScript -->
    </nav>

    <!-- JavaScript Modularizado -->
    <script src="js/ui.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/compost.js"></script>
    <script src="js/auth.js"></script> 
    <script src="js/assistant.js"></script>
    <script src="js/plants.js"></script> 
    <script src="js/main.js"></script>
    
    <script>
        // Función para toggle de ubicación
        function toggleLocation() {
            const toggleContainer = document.getElementById('locationToggleContainer');
            const checkbox = document.getElementById('locationToggle');
            if (toggleContainer && checkbox) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked) {
                    toggleContainer.classList.add('active');
                } else {
                    toggleContainer.classList.remove('active');
                }
                // Recargar el clima con la nueva configuración
                if (typeof getGeoLocationAndFetchWeather === 'function') {
                    getGeoLocationAndFetchWeather();
                }
            }
        }
    </script>
</body>
</html>