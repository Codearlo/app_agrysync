<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AgroSync</title>
    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/diagnosis.css">
    <link rel="stylesheet" href="css/compost.css">
    <link rel="stylesheet" href="css/assistant.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/dark_mode.css">
    <link rel="stylesheet" href="css/responsive_utilities.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Contenedor para el Header Dinámico -->
        <header class="app-header" id="main-app-header">
            <!-- El contenido del header se cargará aquí por JavaScript -->
        </header>

        <!-- Page: Home -->
        <div id="home" class="page"> <!-- Ya no 'active' por defecto, main.js lo maneja -->
            <!-- El header específico de esta página se ha movido al header principal dinámico -->
            <main class="main-content">
                <!-- Contenido de Home -->
                <section class="weather-card card">
                    <div class="weather-header">
                        <h3>Clima Actual</h3>
                        <div class="weather-icon" id="weather-icon-element"><i class="fas fa-spinner fa-spin"></i></div>
                    </div>
                    <div class="weather-grid">
                        <div class="weather-item">
                            <span class="weather-emoji"><i class="fas fa-thermometer-half"></i></span>
                            <div class="weather-value" id="weather-temp">--°</div>
                            <div class="weather-label">Temperatura</div>
                        </div>
                        <div class="weather-item">
                            <span class="weather-emoji"><i class="fas fa-tint"></i></span>
                            <div class="weather-value" id="weather-humidity">--%</div>
                            <div class="weather-label">Humedad</div>
                        </div>
                        <div class="weather-item">
                            <span class="weather-emoji"><i class="fas fa-wind"></i></span>
                            <div class="weather-value" id="weather-wind">--</div>
                            <div class="weather-label">km/h</div>
                        </div>
                    </div>
                    <div id="weather-location" style="text-align: center; margin-top: 15px; font-size: 0.875rem; opacity: 0.8;">Obteniendo ubicación...</div>
                </section>

                <section class="quick-actions">
                    <button class="action-btn" onclick="showPage('diagnosis')">
                        <span class="action-emoji"><i class="fas fa-camera"></i></span>
                        <span class="action-text">Escanear Planta</span>
                    </button>
                    <button class="action-btn secondary" onclick="showPage('assistant')">
                        <span class="action-emoji"><i class="fas fa-robot"></i></span>
                        <span class="action-text">Asistente IA</span>
                    </button>
                </section>

                <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-seedling"></i></span>
                        <h3 class="section-title">Mis Plantas</h3>
                    </div>
                    <div id="plants-list-container" class="plants-list">
                        <p id="no-plants-message" style="display: none; text-align: center; color: var(--gray-500);">Aún no has añadido ninguna planta. ¡Ve a tu perfil para empezar!</p>
                    </div>
                </section>

                <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-bell"></i></span>
                        <h3 class="section-title">Alertas Recientes</h3>
                    </div>
                    <div class="notifications-list">
                         <div class="notification notification-high">
                            <div class="notification-content">
                                <div class="notification-text"><i class="fas fa-exclamation-triangle"></i> Posible plaga detectada en tomates</div>
                                <div class="notification-time">hace 5 min</div>
                            </div>
                        </div>
                        <div class="notification notification-success">
                             <div class="notification-content">
                                <div class="notification-text"><i class="fas fa-check-circle"></i> Compostaje óptimo - pH perfecto</div>
                                <div class="notification-time">hace 1h</div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Page: Diagnosis -->
        <div id="diagnosis" class="page">
            <!-- El header específico de esta página se ha movido al header principal dinámico -->
            <main class="main-content">
                <div class="page-header">
                    <h2><i class="fas fa-stethoscope"></i> Diagnóstico de Plantas</h2>
                    <p>Usa la cámara para identificar enfermedades o deficiencias.</p>
                </div>
                <section class="camera-section card">
                    <div class="camera-interface">
                        <div class="camera-preview">
                            <span class="camera-emoji"><i class="fas fa-camera-retro"></i></span>
                            <p>Apunta a la hoja afectada y toma una foto clara.</p>
                        </div>
                        <button class="camera-btn" onclick="simulateCamera(event)"><i class="fas fa-camera"></i> Tomar Foto</button>
                    </div>
                </section>
                 <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-microscope"></i></span>
                        <h3 class="section-title">Resultados del Análisis</h3>
                    </div>
                    <div class="analysis-results">
                        <!-- ... contenido de análisis ... -->
                         <div class="analysis-card analysis-warning">
                            <div class="analysis-header">
                                <span class="analysis-emoji"><i class="fas fa-exclamation-triangle"></i></span>
                                <h4 class="analysis-title">Riesgo Detectado</h4>
                            </div>
                            <p>Probabilidad de pulgón en los próximos 7 días: 75%</p>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Page: Compost Calculator -->
        <div id="compost" class="page">
            <!-- El header específico de esta página se ha movido al header principal dinámico -->
            <main class="main-content">
                 <div class="page-header">
                    <h2><i class="fas fa-calculator"></i> Calculadora de Compostaje</h2>
                    <p>Planifica tu compostaje para obtener el mejor abono.</p>
                </div>
                 <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-balance-scale"></i></span>
                        <h3 class="section-title">Ingresa tus Datos</h3>
                    </div>
                    <div class="compost-calculator-input">
                        <label for="compost-amount">Cantidad de compost deseada (kg):</label>
                        <input type="number" id="compost-amount" value="1" min="0.5" step="0.5">
                        <button id="calculate-compost-btn" class="action-btn" style="margin-top: 1rem; width: 100%;"><i class="fas fa-cogs"></i> Calcular</button>
                    </div>
                </section>
                <section id="compost-results-section" class="card" style="display: none;">
                     <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-chart-pie"></i></span>
                        <h3 class="section-title">Resultados Estimados</h3>
                    </div>
                    <div class="compost-results">
                        <!-- ... contenido de resultados de compost ... -->
                    </div>
                </section>
            </main>
        </div>
        
        <!-- Page: Assistant -->
        <div id="assistant" class="page">
            <!-- El header específico de esta página se ha movido al header principal dinámico -->
            <main class="main-content">
                 <div class="page-header">
                    <h2><i class="fas fa-comments"></i> Chatea con AgriBot</h2>
                    <p>Resuelve tus dudas sobre jardinería y agricultura.</p>
                </div>
                <section class="card" style="padding: 0; overflow:visible;">
                    <div class="chat-interface"> 
                        <div class="chat-messages">
                            <div class="message bot">¡Hola! Soy AgriBot. ¿Cómo puedo ayudarte con tu jardín hoy?</div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="userInput" placeholder="Escribe tu pregunta aquí...">
                            <button id="sendMessageBtn"><i class="fas fa-paper-plane"></i> Enviar</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Page: Profile -->
        <div id="profile" class="page">
            <!-- El header específico de esta página se ha movido al header principal dinámico -->
            <main class="main-content">
                <section class="profile-info">
                    <div class="profile-avatar" id="profile-avatar-initials">--</div>
                    <h3 id="profile-username">Nombre de Usuario</h3>
                    <p class="profile-level" id="profile-email">correo@ejemplo.com</p>
                    <button id="logout-btn" class="action-btn danger" style="margin-top: 1.5rem; background: var(--danger);"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
                </section>

                <section class="card">
                    <div class="section-header">
                        <span class="section-emoji"><i class="fas fa-plus-circle"></i></span>
                        <h3 class="section-title">Añadir Nueva Planta</h3>
                    </div>
                    <form id="add-plant-form" class="add-plant-form">
                        <div class="form-group">
                            <label for="plant-name">Nombre de la Planta:</label>
                            <input type="text" id="plant-name" name="plant_name" required>
                        </div>
                        <div class="form-group">
                            <label for="plant-description">Descripción (opcional):</label>
                            <textarea id="plant-description" name="plant_description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="plant-health">Estado de Salud Inicial:</label>
                            <select id="plant-health" name="plant_health" required>
                                <option value="Saludable" selected>Saludable</option>
                                <option value="Advertencia">Advertencia</option>
                                <option value="Peligro">Peligro</option>
                            </select>
                        </div>
                        <button type="submit" class="action-btn" style="width: 100%; margin-top: 1rem;">
                            <i class="fas fa-save"></i> Guardar Planta
                        </button>
                    </form>
                    <div id="add-plant-message" class="form-message" style="margin-top: 1rem;"></div>
                </section>
                <!-- ... resto del contenido de perfil ... -->
            </main>
        </div>
    </div>

    <nav class="bottom-nav" style="display: none;"> <!-- Oculta por defecto -->
        <button class="nav-item active" onclick="showPage('home')">
            <span class="nav-emoji"><i class="fas fa-home"></i></span>
            <span class="nav-label">Inicio</span>
        </button>
        <button class="nav-item" onclick="showPage('diagnosis')">
            <span class="nav-emoji"><i class="fas fa-stethoscope"></i></span>
            <span class="nav-label">Diagnóstico</span>
        </button>
        <button class="nav-item" onclick="showPage('compost')"> 
            <span class="nav-emoji"><i class="fas fa-recycle"></i></span>
            <span class="nav-label">Compost</span>
        </button>
         <button class="nav-item" onclick="showPage('assistant')">
            <span class="nav-emoji"><i class="fas fa-comments"></i></span>
            <span class="nav-label">Asistente</span>
        </button>
        <button class="nav-item" onclick="showPage('profile')">
            <span class="nav-emoji"><i class="fas fa-user-circle"></i></span>
            <span class="nav-label">Perfil</span>
        </button>
    </nav>

    <!-- JavaScript Modularizado -->
    <script src="js/ui.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/compost.js"></script>
    <script src="js/auth.js"></script> 
    <script src="js/assistant.js"></script>
    <script src="js/plants.js"></script> 
    <script src="js/main.js"></script> 
</body>
</html>
